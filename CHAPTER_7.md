# Глава 7: Епилог — Краят на търговията със страх

През последните месеци бяхме свидетели на невиждана кампания по насаждане на страх. Адвокатски кантори, които не могат да напишат един SQL SELECT, обясняваха на счетоводителите как НАП ще ги глоби за "неправилно тълкуване". Консултанти продаваха уебинари, на които четоха на глас екселски таблици.

**Време е да сложим край на това.**

## Истината е в кода, не в параграфа

SAF-T не е правна революция. Той е дигитална санитария.
Ако вашата система е изградена правилно – ако използвате релационни бази данни (или модерни NoSQL решения като SurrealDB), ако имате строга типизация (като в Rust), ако сте мапнали вашите 411 и 702 към номенклатурата на НАП и ако не изписвате "кашони" в склад за "литри" – **вие сте в безопасност.**

XSD валидаторът няма адвокат. Той не приема подкупи, не се впечатлява от титли и не се интересува от правни становища. Той чете тагове. `<nsSAFT:DebitAmount>` трябва да е равно на `<nsSAFT:CreditAmount>`. Ако е така – минавате.

## Счетоводителят на бъдещето

Вие вече не сте просто оператори на данни. Вие сте **Data Engineers**. Вие управлявате потоци от информация, гарантирате интегритета на базите данни и работите в реално време. 

Не позволявайте на хора извън вашата професия да ви учат на счетоводна архитектура. Изисквайте от създателите на вашия софтуер да ви дадат инструменти за мапинг, за локална валидация и за автоматизация, вместо да ви прехвърлят отговорността.

Ние в baraba.org направихме точно това. Пренаписахме системата си, за да отговаря на стандарта, без да ви превръщаме в програмисти. Защото вярваме, че добрият софтуер работи за вас, а не вие за него.

## Action Plan: 3 стъпки от хаос към готовност

Стига приказки. Ето конкретно какво правите — днес, този месец и оттук нататък.

### Стъпка 1: Веднага (тази седмица)

Целта е да разберете **колко зле стоите** — без илюзии, без оправдания.

| # | Действие | Какво очаквате | Глава |
|---|----------|---------------|-------|
| 1 | **Извадете пълния сметкоплан** от софтуера си — списък на всички сметки с наименования, нива, аналитичности | Плосък CSV/Excel файл. Ако софтуерът не може да го даде — това е първият червен флаг | Гл. 3 |
| 2 | **Проверете дали имате 360-те сметки на НАП** — отворете Приложение А и сравнете. Колко от вашите сметки нямат съответствие? | Число: „47 от 120-те ни сметки нямат мапинг" | Гл. 3 |
| 3 | **Извадете списък на контрагентите** — всички клиенти и доставчици с ЕИК/ДДС номер | Колко нямат ЕИК? Колко са дублирани? Колко са „Клиент 1", „Разни" или „Каса"? | Гл. 1 |
| 4 | **Проверете мерните единици** — какви UOM използвате в складовия модул | Колко са „бр.", колко „бройки", колко „Бр" — и дали изобщо можете да ги конвертирате до UN/ECE кодове | Гл. 4, 5 |
| 5 | **Поискайте от софтуерния доставчик** писмен отговор: „Кога ще имате SAF-T експорт по Заповед № ЗМФ-…?" | Ако отговорът е неясен — започнете да търсите алтернатива. Сега, не след 6 месеца | Гл. 0, 0А |

**Резултат след Стъпка 1:** Имате 5 файла на бюрото си и реалистична оценка на мащаба на проблема. Нищо не е поправено, но знаете какво трябва да се поправи.

### Стъпка 2: В рамките на 30 дни

Целта е **да затворите критичните дупки** — тези, които ще провалят първото подаване.

| # | Действие | Как го правите | Глава |
|---|----------|---------------|-------|
| 1 | **Мапнете сметкоплана** — всяка ваша сметка трябва да има `AccountID` (от НАП) и `TaxpayerAccountID` (ваш) | Ръчно в Excel или с инструмент за мапинг. Ако имате 500 сметки, очаквайте 2-3 работни дни. Без това — няма SAF-T | Гл. 3 |
| 2 | **Изчистете контрагентите** — слейте дублираните, попълнете липсващите ЕИК, генерирайте SAF-T ID (10XXXXXXXXX за БГ, 11XXXXXXXXX за ЕС) | Ползвайте Python скрипта за дедупликация от Гл. 11.1 или ръчно в софтуера | Гл. 1, 11 |
| 3 | **Настройте данъчните кодове (TaxTable)** — заменете свободните текстове („ДДС 20%", „без ддс", „ддс вкл.") с кодовете от Приложение Б | Вътрешна номенклатура в софтуера. Ако софтуерът не поддържа структурирани данъчни кодове — виж Стъпка 1, точка 5 | Гл. 3 |
| 4 | **Стандартизирайте мерните единици** — „бр." → C62, „кг" → KGM, „кашон" → CT. Без изключения | Python скрипт от Гл. 5 или ръчна таблица за конверсия | Гл. 4, 5 |
| 5 | **Направете пробно подаване** — генерирайте XML за последния приключен месец и валидирайте срещу XSD | Ако нямате SAF-T генератор — използвайте ръчен шаблон от Приложение Е и попълнете поне Header + MasterFiles | Гл. 2, 6, 10 |
| 6 | **Пуснете risk score анализа** от Гл. 11.6 върху данните си — амортизации, вечни салда, залежали запаси, смесени разходи | Python скриптовете от секции 11.6.1–11.6.5. Ако резултатът е HIGH/CRITICAL — имате данъчни проблеми, които SAF-T само ще направи видими | Гл. 11 |

**Резултат след Стъпка 2:** Имате работещ мапинг, чисти номенклатури и поне един валидиран XML файл. Знаете кои данъчни политики са рискови.

### Стъпка 3: Постоянен контрол (всеки месец)

Целта е **да не се върнете назад** — защото данните се замърсяват с всяка нова операция.

| # | Контрол | Честота | Как |
|---|---------|---------|-----|
| 1 | **Нов контрагент = попълнен ЕИК + SAF-T ID** | При всяко въвеждане | Правило в софтуера: нов контрагент без ЕИК → предупреждение. Без SAF-T ID → грешка |
| 2 | **Съгласуване: Оборотна ведомост ↔ Журнал ↔ ДДС дневници** | Месечно, преди подаване | `TotalDebit == TotalCredit` в GeneralLedgerEntries. Сума на фактурите по ДДС дневник == сума в SourceDocuments. Ако не бият — не подавайте |
| 3 | **Нови сметки = веднага мапнати** | При откриване на нова сметка | Ако счетоводителят открие нова подсметка — тя трябва да има `AccountID` от НАП в рамките на същия ден |
| 4 | **Складова дисциплина: без отрицателни количества** | Месечно | Справка за артикули с qty < 0. Ако има — коригирайте преди приключване на периода |
| 5 | **XSD валидация на генерирания файл** | Преди всяко подаване | Локална валидация (Rust/Python от Гл. 10), не на сървъра на НАП. Руска рулетка не се играе с данъчни декларации |
| 6 | **Risk score мониторинг** | Тримесечно | Пуснете анализа от Гл. 11.6. Следете тренда: ако score расте — имате системен проблем |

### Контролен списък „Готовност за SAF-T"

Преди първото подаване, всяка точка трябва да е ✓:

```
НОМЕНКЛАТУРИ
  [ ] Сметкоплан: всяка сметка има AccountID (НАП) + TaxpayerAccountID (фирмен)
  [ ] Контрагенти: всеки има SAF-T ID (10/11/12/13/15 префикс)
  [ ] Контрагенти: няма дублирани записи за един и същ ЕИК
  [ ] Данъчни кодове: TaxTable е попълнена, няма свободни текстове
  [ ] Мерни единици: всички конвертирани до UN/ECE кодове (C62, KGM, LTR…)

ДАННИ
  [ ] Оборотна ведомост: TotalDebit == TotalCredit
  [ ] Журнал: всяка статия има поне един ред с Debit и един с Credit
  [ ] Фактури: всяка има InvoiceNo, InvoiceDate, CustomerID/SupplierID
  [ ] Плащания: всяко плащане е свързано с документ (фактура/РКО/ПКО)
  [ ] Складови наличности: няма артикули с qty < 0

ВАЛИДАЦИЯ
  [ ] XML файлът минава XSD валидация без грешки
  [ ] NumberOfEntries съвпада с реалния брой записи
  [ ] TotalDebit/TotalCredit в Header съвпадат със сумите в журнала
  [ ] Всички CustomerID/SupplierID в журнала съществуват в MasterFiles
  [ ] Всички AccountID в журнала съществуват в GeneralLedgerAccounts

ДАНЪЧНИ РИСКОВЕ (Гл. 11.6)
  [ ] Амортизации: счетоводен полезен живот не е агресивно по-кратък от данъчния
  [ ] Разчетни сметки: няма салда без движение > 3 години
  [ ] Запаси: няма залежали артикули > 12 месеца без обезценка/отписване
  [ ] Смесени разходи: има аналитичност лично/служебно за горива, наеми, телеком
  [ ] Обобщен risk score: LOW или MEDIUM
```

### Какво да изискате от софтуерния доставчик

Ако софтуерът ви не може да направи нещо от горния списък — проблемът не е във вас. Ето минималните изисквания към софтуера:

1. **Експорт на SAF-T XML** — месечен, годишен, On Demand. Не „скоро", не „в следващата версия". Сега.
2. **Двоен сметкоплан** — поле за AccountID (НАП) до всяка фирмена сметка
3. **Структурирана TaxTable** — данъчни кодове с ставки, не свободен текст
4. **SAF-T ID генератор** — автоматично генериране на идентификатор за контрагенти по правилата 10/11/12/13/15
5. **Вградена XSD валидация** — преди подаване, не след
6. **Стандартни мерни единици** — UN/ECE кодове, не „бр." и „кашони"
7. **Складова интеграция** — PhysicalStock и MovementOfGoods да се генерират от складовия модул, не от Excel
8. **Одитна следа** — кой, кога, какво е променил. Без това SAF-T е безсмислен

Ако доставчикът ви не може да предостави поне точки 1-5 — **сменете доставчика**. Не утре. Тази седмица.

**Игнорирайте шума. Подредете си данните. И продължавайте напред.**